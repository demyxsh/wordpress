#!/bin/bash
# Demyx
# https://demyx.sh
set -euo pipefail
#
#   Main.
#
demyx_entrypoint() {
    # Install WordPress
    demyx-install

    # Generate configs
    demyx-config

    # Start crond
    sudo -E demyx-sudo cron

    # Default to php version 8 if user inputs an incorrect version
    case "$DEMYX_PHP" in
        8|8.0)
            DEMYX_PHP=8
        ;;
        8.1)
            DEMYX_PHP=81
        ;;
        *)
            DEMYX_PHP=8
        ;;
    esac

    # Run php-fpm in the foreground
    php-fpm"$DEMYX_PHP" -F
}
#
#   Init.
#
demyx_entrypoint
